apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx
  labels:
    app: nginx
spec:
  replicas: 1
  selector:
    matchLabels:
      app: application
      tier: nginx
      track: stable
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:latest
        volumeMounts:
        - name: nginx-conf
          mountPath: /etc/nginx/
        ports:
        - containerPort: 80
      volumes:
      - name: nginx-conf
        configMap:
          name: nginx-conf
          items:
          - key: nginx.conf
            path: nginx.conf
            
---
apiVersion: v1
kind: Service
metadata:
  name: nginx				
spec:
  selector:
    app: application
    tier: nginx
  ports:
  - protocol: TCP
    port: 80
    targetPort: 80
  type: LoadBalancer
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: frontend
  labels:
    app: frontend
spec:
  replicas: 1
  selector:
    matchLabels:
      app: frontend
  template:
    metadata:
      labels:
        app: application
        tier: frontend
        track: stable
    spec:
      containers:
      - name: frontend
        image: jenkins-kuber:5000/frontend:build-0
        ports:
        - containerPort: 5000
        readinessProbe:
          httpGet:
            path: /
            port: 5000
---
apiVersion: v1
kind: Service
metadata:
  name: frontend				
spec:
  selector:
    app: application
    tier: frontend
  ports:
  - protocol: TCP
    port: 80
    targetPort: http
#  type: ClusterIP
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: service1
  labels:
    app: service1
spec:
  replicas: 1
  selector:
    matchLabels:
      app: service1
  template:
    metadata:
      labels:
        app: service1
    spec:
      containers:
      - name: service1
        image: jenkins-kuber:5000/service1:build-0
        ports:
        - containerPort: 5001
        
---
apiVersion: v1
kind: Service
metadata:
  name: service1				
spec:
  selector:
    app: service1
  ports:
  - protocol: TCP
    port: 5000
    targetPort: 5001
  type: ClusterIP
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: service2
  labels:
    app: service2
spec:
  replicas: 1
  selector:
    matchLabels:
      app: service2
  template:
    metadata:
      labels:
        app: service2
    spec:
      containers:
      - name: service2
        image: jenkins-kuber:5000/service2:build-0
        ports:
        - containerPort: 5002
        
---
apiVersion: v1
kind: Service
metadata:
  name: service2				
spec:
  selector:
    app: service2
  ports:
  - protocol: TCP
    port: 5000
    targetPort: 5002
  type: ClusterIP
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: service3
  labels:
    app: service3
spec:
  replicas: 1
  selector:
    matchLabels:
      app: service3
  template:
    metadata:
      labels:
        app: service3
    spec:
      containers:
      - name: service3
        image: jenkins-kuber:5000/service3:build-0
        ports:
        - containerPort: 5003
        
---
apiVersion: v1
kind: Service
metadata:
  name: service3				
spec:
  selector:
    app: service3
  ports:
  - protocol: TCP
    port: 5000
    targetPort: 5003
  type: ClusterIP

    
